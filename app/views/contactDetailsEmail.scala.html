@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models._
@import uk.gov.hmrc.play.frontend.auth.AuthContext
@(contactDetailsEmailForm: Form[ContactDetailsEmail], mode: Option[String], backLink: Option[String])(implicit request: Request[_], authContext: AuthContext, messages: Messages)
@import uk.gov.hmrc.play.views.html._
@import uk.gov.hmrc.play.views.html.helpers._
@import views.html.helpers._
@import utils.AuthUtils._

@implicitFormInstance = @{ Some(contactDetailsEmailForm) }

@pageScripts = {
  <script src='@controllers.routes.AssetsController.at("javascript/show-hide-content.js")'></script>
  <script>
    $(document).ready(function() {
      // Where .multiple-choice uses the data-target attribute
      // to toggle hidden content
      var showHideContent = new GOVUK.ShowHideContent()
      showHideContent.init()

      //Clear input when selecting 'No'
      $('input[type=radio][name=emailConsent]').change(function(){
        if(this.value == 'true') {
          // Do nothing
        } else {
          $('#email').val("");
        }
      });

    });
  </script>
}

@atedMain(title = Messages("ated.contact-details-email-title"), pageScripts = Some(pageScripts)) {
    @pageHeadersAndError(backLink, "subtitle", if(isAgent) {Messages("ated.contact-details.agent.subheader")} else {Messages("ated.contact-details.subheader")}, "contact-details-email.header", Messages("ated.contact-details-email-header"),
        Some(atedErrorSummary(contactDetailsEmailForm, "ated.contact-details-error.general")))

  <p id="lede">@Messages("ated.contact-details-email-lede")</p>

  <div id = "email-consent-risk">
    <details>
      <summary class="summary" id="email-risk-question" data-journey-click="ated-subscription:click:email-risk-question">
        @Messages("ated.contact-details.email.risk.help.text")
      </summary>
      <div id="details-content-0" class="panel-indent">
        <p>@Messages("ated.contact-details.email.risk.p1")</p>
        <p>@Messages("ated.contact-details.email.risk.p2")</p>
        <p>@Messages("ated.contact-details.email.risk.p3")</p>
        <p>@Html(Messages("ated.contact-details.email.risk.email"))</p>
        <p>@Messages("ated.contact-details.email.risk.p4")</p>
        <p>@Messages("ated.contact-details.email.risk.p5")</p>
      </div>
    </details>
  </div>

  @form(action = controllers.routes.ContactDetailsEmailController.submit(mode)) {

    <div class="form-group" id="emailConsent">

      @atedInputRadioGroupReveal(contactDetailsEmailForm("emailConsent"),
        Seq("true" -> (Messages("ated.radio.yes.label"), Some("email-contact-hidden")),
            "false" -> (Messages("ated.radio.no.label"), None)),
        '_legend -> Messages("ated.contact-details-email-header"),
        '_legendClass -> "visuallyhidden",
        '_groupClass -> "inline",
        '_labelClass -> "block-label",
        '_labelAfter -> true,
        '_trackGA -> true
      )

      <div id="email-contact-hidden" class="form-group js-hidden">
        <div class="panel-indent">
          @atedInput(contactDetailsEmailForm("email"),
            '_label ->  Html(Messages("ated.contact-details.email")),
            '_labelClass -> "form-label",
            '_inputClass -> "form-control-indent",
            '_type -> "text",
            '_showConstraints -> false)
        </div>
    </div>

    </div>

    <button class="button" id="submit" type="submit">@Messages("ated.contact-details.continue")</button>

  }
}